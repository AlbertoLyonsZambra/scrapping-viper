name: ci-cd

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  CI:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Set up Python 3.12
      uses: actions/setup-python@v4
      with:
        python-version: 3.12.x
    - name: Restore dependencies
      run: pip install --no-cache-dir -r requirements.txt
    - name: Login to Docker Hub
      run: echo "${{ secrets.DOCKERHUB_TOKEN }}" | docker login -u "${{ secrets.DOCKERHUB_USERNAME }}" --password-stdin
    - name: Docker Build
      run: docker build -t scrapping-viper-app -f Dockerfile .
    - name: Docker Tag
      run: docker tag scrapping-viper-app "${{ secrets.DOCKERHUB_USERNAME }}"/scrapping-viper-app
    - name: Docker push
      run: docker push "${{ secrets.DOCKERHUB_USERNAME }}"/scrapping-viper-app
  #CD:
  #  needs: CI
  #  runs-on: ubuntu-latest
  #  steps:
  #  - uses: actions/checkout@v4
  #  - name: Deploy to Render
  #    run: curl -X POST "${{ secrets.DEPLOY_WEBHOOK }}"

